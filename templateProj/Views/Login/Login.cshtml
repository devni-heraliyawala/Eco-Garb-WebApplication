@model templateProj.Models.UserModel

@{
    
    Layout = null;
}

<!DOCTYPE html>

@*<html>
    <head>
        <meta name="viewport" content="width=device-width" />
        <title>login</title>
    </head>
    <body>
        <div>
        </div>
    </body>
    </html>
        <a href="register.html" class="text-center">Register a new membership</a>

*@






<html>
<head>
   
 

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Eco-Garb | Log in</title>
    <!-- Tell the browser to be responsive to screen width -->
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <!-- Bootstrap 3.3.5 -->
    <link rel="stylesheet" href="../../Styles/bootstrap/css/bootstrap.min.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    <!-- Ionicons -->
    <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <!-- Theme style -->
    <link rel="stylesheet" href="../../Styles/dist/css/AdminLTE.min.css">
    <!-- iCheck -->
    <link rel="stylesheet" href="../../Styles/plugins/iCheck/square/blue.css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body class="hold-transition login-page" >

    <style>
        .Valerrorbox {
            margin: -30px auto;
            width: 450px;
            height:154px;
            position: relative;
            background-color:transparent;
        }
    </style>

    <div class="wrapper">
        <div class="login-box">
            <div class="login-logo">
                <a href="../../index2.html"><b>Eco-Garb</b></a>
            </div><!-- /.login-logo -->
            <div class="login-box-body">
                <p class="login-box-msg">Sign in to start your session</p>

                @using (Html.BeginForm("Login", "Login", FormMethod.Post))
                {
                    <div class="form-group has-feedback" id="divUname">
                        <input type="text" name="uname" id="Uname" class="form-control" placeholder="Username" required oninput="checkUserValidity()">

                        <span class="glyphicon glyphicon-user form-control-feedback"></span>
                    </div>
                    <div class="form-group has-feedback" id="divPass">
                        <input type="password" name="pass" id="pass" class="form-control" placeholder="Password" required oninput="checkPasswordValidity()">
                        <span class="glyphicon glyphicon-lock form-control-feedback"></span>
                    </div>
                    <div class="row">
                        <div class="col-xs-8" >
                            <div class="checkbox icheck">
                                    @Html.ActionLink("Register a new membership", "Register", null, new { @style = "color:red;text-decoration:underline" })     
                            </div>
                        </div><!-- /.col -->
                        <div class="col-xs-4" >
                            <button type="submit" class="btn btn-primary btn-block btn-flat" style="background-color:seagreen">Sign In</button>

                        </div><!-- /.col -->
                    </div>
                }
                @*<a href="#">I forgot my password</a><br>*@
           @Html.ActionLink("I forgot my password", "RecoverPass",null,new { @style="text-decoration:underline"})
                <br>
            </div><!-- /.login-box-body -->
        </div><!-- /.login-box -->
        <div class="col-md-3">
           
        </div>
        @if (@ViewBag.errorMsg == "error")
        {
            <div class="box box-default  ; Valerrorbox">
                <div class="alert alert-danger alert-dismissable">
                    <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
                    <h4><i class="icon fa fa-ban"></i> Error!</h4>
                    <ul>
                        <li>The Username or Password you have entered is Invalid.</li>                       
                    </ul>
                </div>
            </div>       
            
        }
        
            <!-- jQuery 2.1.4 -->
            <script src="../../Styles/plugins/jQuery/jQuery-2.1.4.min.js"></script>
            <!-- Bootstrap 3.3.5 -->
            <script src="../../Styles/bootstrap/js/bootstrap.min.js"></script>
            <!-- iCheck -->
            <script src="../../Styles/plugins/iCheck/icheck.min.js"></script>
            <script>
                $(function () {
                    $('input').iCheck({
                        checkboxClass: 'icheckbox_square-blue',
                        radioClass: 'iradio_square-blue',
                        increaseArea: '20%' // optional
                    });
                });

             
            </script>

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
        <script>
            function checkUserValidity() {

            var username = document.getElementById("Uname").value;

            $.ajax({
                type: 'GET',
                contentType: "application/json; charset=utf-8",
                url: '/Login/CheckUserValidity',
                data: { username: username },
                dataType: "Json",
            }).success(function (result) {

                //if user exists
                if (result.res) {
                    var exists = document.getElementById("unameValidate");
                    if (exists) {
                        //error occured
                        // remove it
                        var parent = document.getElementById("divUname");
                        var child = document.getElementById("unameValidate");
                        parent.removeChild(child);
                        document.getElementById("Uname").style.borderColor = "green";

                    }
                }
            }).error(function (xhr, ajaxOptions, thrownError) {
                var para = document.createElement("p");
                para.setAttribute("id", "unameValidate")
                var node = document.createTextNode("Invalid username");
                para.appendChild(node);
                var element = document.getElementById("divUname");
                element.appendChild(para);

                var child = document.getElementById("unameValidate");
                element.replaceChild(para, child);

                document.getElementById("unameValidate").style.color = "red";
                document.getElementById("Uname").style.borderColor = "red";
            });
          }

            function checkPasswordValidity() {
                var username = document.getElementById("Uname").value;
                var password = document.getElementById("pass").value;

                $.ajax({
                    type: 'GET',
                    contentType: "application/json; charset=utf-8",
                    url: '/Login/CheckPasswordValidity',
                    data: { username: username, password: password },
                    dataType: "Json",
                }).success(function (result) {

                    //if user exists
                    if (result.res) {
                        var exists = document.getElementById("passValidate");
                        if (exists) {
                            //error occured
                            // remove it
                            var parent = document.getElementById("divPass");
                            var child = document.getElementById("passValidate");
                            parent.removeChild(child);
                            document.getElementById("pass").style.borderColor = "green";

                        }
                    }
                }).error(function (xhr, ajaxOptions, thrownError) {
                    var para = document.createElement("p");
                    para.setAttribute("id", "passValidate")
                    var node = document.createTextNode("Incorrect Password");
                    para.appendChild(node);
                    var element = document.getElementById("divPass");
                    element.appendChild(para);

                    var child = document.getElementById("passValidate");
                    element.replaceChild(para, child);

                    document.getElementById("passValidate").style.color = "red";
                    document.getElementById("pass").style.borderColor = "red";
                });
            }
        </script>

        </div>
    <footer style="position:absolute ; top:600px ; left:580px ">
        Copyright © 2016 · All Rights Reserved
    </footer>
</body>

</html>